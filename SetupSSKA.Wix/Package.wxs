<?xml version="1.0" encoding="UTF-8"?>

<!--
  SSKA Analyzer Installer
  Built with WiX Toolset v5

  Prerequisites: Build WpfApplication1 first with MSBuild:
    msbuild ..\WpfApplication1\WpfApplication1.csproj /p:Configuration=Release

  Then build this installer:
    dotnet build SetupSSKA.Wix.wixproj -c Release

  Output: bin\Release\x64\SetupSSKA.Wix.msi
-->

<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package
    Name="SSKA Analyzer"
    Manufacturer="V_Zdravkov"
    Version="2.1.0"
    UpgradeCode="E8F5B9A1-7C3D-4E2F-9A1B-5C8D7E6F4A3B"
    Scope="perMachine">

    <!-- Upgrade handling for current installer versions -->
    <MajorUpgrade
      DowngradeErrorMessage="A newer version of [ProductName] is already installed."
      AllowSameVersionUpgrades="yes"
      Schedule="afterInstallInitialize" />

    <!-- Detect old Visual Studio Deployment Project installer (different UpgradeCode) -->
    <Upgrade Id="D0D9764A-E258-44BD-B847-E93BAA658CC7">
      <UpgradeVersion Minimum="0.0.0" IncludeMinimum="yes" Maximum="99.0.0" IncludeMaximum="yes"
                      Property="OLDVERSIONFOUND" MigrateFeatures="yes" />
    </Upgrade>

    <!-- Application icon in Add/Remove Programs -->
    <Icon Id="AppIcon.ico" SourceFile="..\WpfApplication1\IconSSKAapp.ico" />
    <Icon Id="DataIcon.ico" SourceFile="..\WpfApplication1\IconSSKAdata.ico" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon.ico" />

    <!-- Detect if user's Categorization.csv already exists -->
    <Property Id="CATEGORIZATIONFILEEXISTS">
      <DirectorySearch Id="SearchUserCategDir" Path="[PersonalFolder]MySSKA\Categorization">
        <FileSearch Id="SearchCategFile" Name="Categorization.csv" />
      </DirectorySearch>
    </Property>

    <!-- Property to control preservation (1=preserve/default, 0=replace) -->
    <Property Id="PRESERVEUSERFILE" Value="1" Secure="yes" />

    <!-- UI Extension - FeatureTree allows users to select optional features -->
    <ui:WixUI Id="WixUI_FeatureTree" />

    <!-- Custom dialog to ask about preserving Categorization.csv -->
    <UI>
      <Dialog Id="CategorizationFileDlg" Width="370" Height="200" Title="[ProductName] Setup">
        <Control Id="Title" Type="Text" X="20" Y="15" Width="330" Height="20" Transparent="yes" NoPrefix="yes"
                 Text="{\WixUI_Font_Title}Categorization File Found" />
        <Control Id="Description" Type="Text" X="20" Y="40" Width="330" Height="50" Transparent="yes" NoPrefix="yes"
                 Text="An existing Categorization.csv file was found in your Documents folder. This file contains your custom category settings. What would you like to do?" />
        <Control Id="PreserveRadio" Type="RadioButtonGroup" X="20" Y="95" Width="330" Height="50" Property="PRESERVEUSERFILE">
          <RadioButtonGroup Property="PRESERVEUSERFILE">
            <RadioButton Value="1" X="0" Y="0" Width="330" Height="18" Text="Keep my existing Categorization.csv (recommended)" />
            <RadioButton Value="0" X="0" Y="22" Width="330" Height="18" Text="Replace with default Categorization.csv" />
          </RadioButtonGroup>
        </Control>
        <Control Id="BottomLine" Type="Line" X="0" Y="161" Width="370" Height="0" />
        <Control Id="Next" Type="PushButton" X="236" Y="170" Width="56" Height="17" Default="yes" Text="Next">
          <Publish Event="EndDialog" Value="Return" />
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="170" Width="56" Height="17" Cancel="yes" Text="Cancel">
          <Publish Event="SpawnDialog" Value="CancelDlg" />
        </Control>
      </Dialog>

      <!-- Insert our dialog into the UI sequence after CostFinalize -->
      <InstallUISequence>
        <Show Dialog="CategorizationFileDlg" After="CostFinalize" Condition="CATEGORIZATIONFILEEXISTS" />
      </InstallUISequence>
    </UI>

    <!-- License/info text explaining what will be installed -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

    <!-- Installation directory structure -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="SSKAanalyzer">
        <!-- Satellite assembly folders for localization -->
        <Directory Id="DeCultureFolder" Name="de" />
        <Directory Id="RuCultureFolder" Name="ru" />
      </Directory>
    </StandardDirectory>

    <!-- Program Menu shortcut (All Users) -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="SSKA Analyzer" />
    </StandardDirectory>

    <!-- Desktop shortcuts -->
    <StandardDirectory Id="DesktopFolder" />

    <!-- User Documents folder for MySSKA data -->
    <StandardDirectory Id="PersonalFolder">
      <Directory Id="MySSKAFolder" Name="MySSKA">
        <Directory Id="ArxivFolder" Name="Arxiv" />
        <Directory Id="CategorizationUserFolder" Name="Categorization">
          <Directory Id="ImageFormatsFolder" Name="imageformats" />
          <Directory Id="PlatformsFolder" Name="platforms" />
        </Directory>
      </Directory>
    </StandardDirectory>

    <!-- Main application files -->
    <ComponentGroup Id="MainApplication" Directory="INSTALLFOLDER">
      <!-- Main executable and config -->
      <Component Id="MainExecutable">
        <File Id="SSKAanalyzer.exe" Source="..\WpfApplication1\bin\x64\Release\SSKAanalyzer.exe" KeyPath="yes" />
      </Component>
      <Component Id="AppConfig">
        <File Source="..\WpfApplication1\bin\x64\Release\SSKAanalyzer.exe.config" />
      </Component>

      <!-- Project DLLs -->
      <Component Id="SimpleSecurity">
        <File Source="..\WpfApplication1\bin\x64\Release\SimpleSecurity.dll" />
      </Component>
      <Component Id="CategoryFormatter">
        <File Source="..\WpfApplication1\bin\x64\Release\CategoryFormatter.dll" />
      </Component>
      <Component Id="DataVisualization">
        <File Source="..\WpfApplication1\bin\x64\Release\DotNetProjects.DataVisualization.Toolkit.dll" />
      </Component>

      <!-- Microsoft.Bcl -->
      <Component Id="MsBclAsyncInterfaces">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Bcl.AsyncInterfaces.dll" />
      </Component>

      <!-- Microsoft.Extensions.Configuration -->
      <Component Id="MsExtConfig">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.dll" />
      </Component>
      <Component Id="MsExtConfigAbs">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.Abstractions.dll" />
      </Component>
      <Component Id="MsExtConfigBinder">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.Binder.dll" />
      </Component>
      <Component Id="MsExtConfigCommandLine">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.CommandLine.dll" />
      </Component>
      <Component Id="MsExtConfigEnvVars">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.EnvironmentVariables.dll" />
      </Component>
      <Component Id="MsExtConfigFileExt">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.FileExtensions.dll" />
      </Component>
      <Component Id="MsExtConfigJson">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.Json.dll" />
      </Component>
      <Component Id="MsExtConfigUserSecrets">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Configuration.UserSecrets.dll" />
      </Component>

      <!-- Microsoft.Extensions.DependencyInjection -->
      <Component Id="MsExtDI">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.DependencyInjection.dll" />
      </Component>
      <Component Id="MsExtDIAbs">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.DependencyInjection.Abstractions.dll" />
      </Component>

      <!-- Microsoft.Extensions.Diagnostics -->
      <Component Id="MsExtDiagnostics">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Diagnostics.dll" />
      </Component>
      <Component Id="MsExtDiagnosticsAbs">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Diagnostics.Abstractions.dll" />
      </Component>

      <!-- Microsoft.Extensions.FileProviders -->
      <Component Id="MsExtFileProvidersAbs">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.FileProviders.Abstractions.dll" />
      </Component>
      <Component Id="MsExtFileProvidersPhysical">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.FileProviders.Physical.dll" />
      </Component>
      <Component Id="MsExtFileSystemGlobbing">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.FileSystemGlobbing.dll" />
      </Component>

      <!-- Microsoft.Extensions.Hosting -->
      <Component Id="MsExtHosting">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Hosting.dll" />
      </Component>
      <Component Id="MsExtHostingAbs">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Hosting.Abstractions.dll" />
      </Component>

      <!-- Microsoft.Extensions.Logging -->
      <Component Id="MsExtLogging">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.dll" />
      </Component>
      <Component Id="MsExtLoggingAbs">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.Abstractions.dll" />
      </Component>
      <Component Id="MsExtLoggingConfig">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.Configuration.dll" />
      </Component>
      <Component Id="MsExtLoggingConsole">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.Console.dll" />
      </Component>
      <Component Id="MsExtLoggingDebug">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.Debug.dll" />
      </Component>
      <Component Id="MsExtLoggingEventLog">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.EventLog.dll" />
      </Component>
      <Component Id="MsExtLoggingEventSource">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Logging.EventSource.dll" />
      </Component>

      <!-- Microsoft.Extensions.Options -->
      <Component Id="MsExtOptions">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Options.dll" />
      </Component>
      <Component Id="MsExtOptionsConfigExt">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Options.ConfigurationExtensions.dll" />
      </Component>
      <Component Id="MsExtPrimitives">
        <File Source="..\WpfApplication1\bin\x64\Release\Microsoft.Extensions.Primitives.dll" />
      </Component>

      <!-- System DLLs -->
      <Component Id="SysBuffers">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Buffers.dll" />
      </Component>
      <Component Id="SysDiagnosticsDiagnosticSource">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Diagnostics.DiagnosticSource.dll" />
      </Component>
      <Component Id="SysIOPipelines">
        <File Source="..\WpfApplication1\bin\x64\Release\System.IO.Pipelines.dll" />
      </Component>
      <Component Id="SysMemory">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Memory.dll" />
      </Component>
      <Component Id="SysNumericsVectors">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Numerics.Vectors.dll" />
      </Component>
      <Component Id="SysRuntimeUnsafe">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Runtime.CompilerServices.Unsafe.dll" />
      </Component>
      <Component Id="SysTextEncodingCodePages">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Text.Encoding.CodePages.dll" />
      </Component>
      <Component Id="SysTextEncodingsWeb">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Text.Encodings.Web.dll" />
      </Component>
      <Component Id="SysTextJson">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Text.Json.dll" />
      </Component>
      <Component Id="SysThreadingTasksExt">
        <File Source="..\WpfApplication1\bin\x64\Release\System.Threading.Tasks.Extensions.dll" />
      </Component>
      <Component Id="SysValueTuple">
        <File Source="..\WpfApplication1\bin\x64\Release\System.ValueTuple.dll" />
      </Component>
      <!-- Template Categorization.csv in install folder - users can copy to restore defaults -->
      <Component Id="CategorizationTemplate">
        <File Id="Categorization.csv.template" Name="Categorization.csv.template" Source="..\Categorization\Categorization.csv" />
      </Component>
    </ComponentGroup>

    <!-- German localization satellite assembly -->
    <ComponentGroup Id="GermanLocalization" Directory="DeCultureFolder">
      <Component Id="GermanResources" Guid="A1B2C3D4-DE01-4E5F-A1B2-0000000000D1">
        <File Id="SSKAanalyzer.resources.dll.de" Source="..\WpfApplication1\bin\x64\Release\de\SSKAanalyzer.resources.dll" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Russian localization satellite assembly -->
    <ComponentGroup Id="RussianLocalization" Directory="RuCultureFolder">
      <Component Id="RussianResources" Guid="A1B2C3D4-5001-4E5F-A1B2-000000000501">
        <File Id="SSKAanalyzer.resources.dll.ru" Source="..\WpfApplication1\bin\x64\Release\ru\SSKAanalyzer.resources.dll" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Categorization tools (installed to user Documents folder for editability) -->
    <ComponentGroup Id="CategorizationTools" Directory="CategorizationUserFolder">
      <Component Id="Categorizer" Guid="A1B2C3D4-1111-4E5F-A1B2-000000000001">
        <File Id="Categorizer.exe" Source="..\Categorization\Categorizer.exe" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="Categorizer" Type="string" Value="[CategorizationUserFolder]Categorizer.exe" KeyPath="yes" />
      </Component>
      <!-- Categorization.csv: User data file with dialog-controlled preservation
           Dialog asks user whether to preserve or replace existing file on reinstall
           PRESERVEUSERFILE: 1=preserve (default), 0=replace -->

      <!-- Component to remove old file if user chooses to replace -->
      <Component Id="RemoveCategorizationCSV" Guid="A1B2C3D4-2224-4E5F-A1B2-000000000013"
                 Condition="CATEGORIZATIONFILEEXISTS AND PRESERVEUSERFILE=&quot;0&quot;">
        <RemoveFile Id="RemoveOldCategCSV" Name="Categorization.csv" On="install" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="CategorizationReplaced" Type="integer" Value="1" KeyPath="yes" />
      </Component>

      <!-- Main file component - Permanent so it survives uninstall, installs if no file or replace chosen -->
      <Component Id="CategorizationCSV" Guid="A1B2C3D4-2222-4E5F-A1B2-000000000002" Permanent="yes"
                 Condition="NOT CATEGORIZATIONFILEEXISTS OR PRESERVEUSERFILE=&quot;0&quot;">
        <File Id="Categorization.csv" Source="..\Categorization\Categorization.csv" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="CategorizationCSV" Type="string" Value="[CategorizationUserFolder]Categorization.csv" KeyPath="yes" />
      </Component>

      <!-- Registry marker when file is preserved -->
      <Component Id="CategorizationCSVPreserved" Guid="A1B2C3D4-2223-4E5F-A1B2-000000000012"
                 Condition="CATEGORIZATIONFILEEXISTS AND PRESERVEUSERFILE=&quot;1&quot;">
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="CategorizationPreserved" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <!-- Qt Core DLLs -->
      <Component Id="Qt5Core" Guid="A1B2C3D4-3333-4E5F-A1B2-000000000003">
        <File Source="..\Categorization\Qt5Core.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="Qt5Core" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="Qt5Gui" Guid="A1B2C3D4-4444-4E5F-A1B2-000000000004">
        <File Source="..\Categorization\Qt5Gui.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="Qt5Gui" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="Qt5Widgets" Guid="A1B2C3D4-5555-4E5F-A1B2-000000000005">
        <File Source="..\Categorization\Qt5Widgets.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="Qt5Widgets" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="CategorizationFolderComponent">
        <CreateFolder />
        <RemoveFolder Id="RemoveCategorizationFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="categorizationFolder" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Qt imageformats plugins (in user Categorization folder) -->
    <ComponentGroup Id="QtImageFormats" Directory="ImageFormatsFolder">
      <Component Id="qgif" Guid="A1B2C3D4-6666-4E5F-A1B2-000000000006">
        <File Source="..\Categorization\imageformats\qgif.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="qgif" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="qico" Guid="A1B2C3D4-7777-4E5F-A1B2-000000000007">
        <File Source="..\Categorization\imageformats\qico.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="qico" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="qjpeg" Guid="A1B2C3D4-8888-4E5F-A1B2-000000000008">
        <File Source="..\Categorization\imageformats\qjpeg.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="qjpeg" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="ImageFormatsFolderComponent">
        <CreateFolder />
        <RemoveFolder Id="RemoveImageFormatsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="imageFormatsFolder" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Qt platforms plugins (in user Categorization folder) -->
    <ComponentGroup Id="QtPlatforms" Directory="PlatformsFolder">
      <Component Id="qwindows" Guid="A1B2C3D4-9999-4E5F-A1B2-000000000009">
        <File Source="..\Categorization\platforms\qwindows.dll" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer\Files"
                       Name="qwindows" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="PlatformsFolderComponent">
        <CreateFolder />
        <RemoveFolder Id="RemovePlatformsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="platformsFolder" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Program Menu Shortcuts -->
    <ComponentGroup Id="Shortcuts" Directory="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut">
        <Shortcut Id="AppStartMenuShortcut"
                  Name="SSKA Analyzer"
                  Description="Personal Finance Analyzer"
                  Target="[INSTALLFOLDER]SSKAanalyzer.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon.ico" />
        <RemoveFolder Id="CleanUpShortcutFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Fresh Install/Repair Flag - signals app to reset user settings on next launch -->
    <ComponentGroup Id="InstallFlags" Directory="INSTALLFOLDER">
      <Component Id="ResetSettingsFlag" Guid="A1B2C3D4-AAAA-4E5F-A1B2-000000000010">
        <!-- Set ResetSettings flag and remove AppVersion to trigger culture detection on next launch -->
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="ResetSettings" Type="integer" Value="1" KeyPath="yes" />
        <!-- Remove the AppVersion key so version check triggers first-run behavior -->
        <RemoveRegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer" Name="AppVersion" />
      </Component>
    </ComponentGroup>

    <!-- Desktop Shortcuts -->
    <ComponentGroup Id="DesktopShortcuts" Directory="DesktopFolder">
      <Component Id="DesktopAppShortcut">
        <Shortcut Id="DesktopAppShortcut"
                  Name="SSKA"
                  Description="SSKA Analyzer - Personal Finance"
                  Target="[INSTALLFOLDER]SSKAanalyzer.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon.ico" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="desktopShortcut" Type="integer" Value="1" KeyPath="yes" />
      </Component>
      <Component Id="DesktopDataShortcut">
        <Shortcut Id="DesktopDataShortcut"
                  Name="SSKA Storage"
                  Description="SSKA Data Folder"
                  Target="[MySSKAFolder]"
                  Icon="DataIcon.ico" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="dataShortcut" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- MySSKA Data Folder Structure (RemoveFolder only removes if empty - preserves user data) -->
    <ComponentGroup Id="DataFolders" Directory="MySSKAFolder">
      <Component Id="MySSKAFolderComponent">
        <CreateFolder />
        <RemoveFolder Id="RemoveMySSKAFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="dataFolder" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>
    <ComponentGroup Id="ArxivFolderGroup" Directory="ArxivFolder">
      <Component Id="ArxivFolderComponent">
        <CreateFolder />
        <RemoveFolder Id="RemoveArxivFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\VZdravkov\SSKAanalyzer"
                       Name="arxivFolder" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Feature definitions -->
    <Feature Id="MainFeature" Title="SSKA Analyzer" Description="Main application files (required)" Level="1" AllowAbsent="no">
      <ComponentGroupRef Id="MainApplication" />
      <ComponentGroupRef Id="GermanLocalization" />
      <ComponentGroupRef Id="RussianLocalization" />
      <ComponentGroupRef Id="Shortcuts" />
      <ComponentGroupRef Id="InstallFlags" />
    </Feature>

    <Feature Id="DataFoldersFeature" Title="Data Folders" Description="Creates MySSKA folder in Documents with Arxiv (data) and Categorization (tools) subfolders" Level="1" AllowAbsent="no">
      <ComponentGroupRef Id="DataFolders" />
      <ComponentGroupRef Id="ArxivFolderGroup" />
      <ComponentGroupRef Id="CategorizationTools" />
      <ComponentGroupRef Id="QtImageFormats" />
      <ComponentGroupRef Id="QtPlatforms" />
    </Feature>

    <Feature Id="DesktopShortcutsFeature" Title="Desktop Shortcuts" Description="Creates SSKA and SSKA Storage shortcuts on the desktop" Level="1" AllowAbsent="yes">
      <ComponentGroupRef Id="DesktopShortcuts" />
    </Feature>

  </Package>
</Wix>
